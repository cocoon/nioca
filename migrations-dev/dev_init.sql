-- This script will initialize the DB with a valid CA and enc keys to be auto-unsealed during DEV_MODE
-- You can AUTO_UNSEAL with the following values in your .env:
--
-- DEV_MODE=true
-- AUTO_UNSEAL=true
-- AUTO_UNSEAL_SHARD_1=8TZvKACB0uhY2l3RX0FdDpMG0peSba947a2cr1lsLtwvfnDd
-- AUTO_UNSEAL_SHARD_2=8bNDTBj6NVCzw8qnMey3DP5vwK2EPNZNz5FevsPqPCX8acJL
-- AUTO_UNSEAL_ENC_UUID=7aa5066e-39d2-4de7-aeb0-e7a411afa5d9
-- AUTO_UNSEAL_ENC_VALUE=58183998d3ac08a0296cbc5a2ccc30efe285f7fbfbb21fb087075d68b305d7e8
-- UNSEAL_CERT_B64="LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNGekNDQVoyZ0F3SUJBZ0lCQVRBS0JnZ3Foa2pPUFFRREF6QXVNUnN3R1FZRFZRUUREQkpPYVc5allTQkoKYm5SbGNtMWxaR2xoZEdVeER6QU5CZ05WQkFvTUJrMTVJRTl5WnpBZUZ3MHlNekE0TWpNeE5UUTJNak5hRncweQpOREE1TURFeE5UVTJNak5hTUNFeERqQU1CZ05WQkFNTUJVNXBiMk5oTVE4d0RRWURWUVFLREFaTmVTQlBjbWN3CmRqQVFCZ2NxaGtqT1BRSUJCZ1VyZ1FRQUlnTmlBQVNicGVUOHNWZW5QSEJ1N09GSm1jc0haOVNNZVNmUDU4Q0wKcHBTVzA0Y1BGS2FMaXArNldCaU9EejBJR3BFNzhVREdqVkNQajJmaUZ3bGgwSCtXdTdDdTlheDUyYS9TdDZYMAplQ1haTHU2T3lybVJPSjJoVjZRTlByamxkNDRVMDZDamdac3dnWmd3SHdZRFZSMGpCQmd3Rm9BVVN2bUJoKzF1CkdIOVNpeGFtWnk4TGMzUkRJdmN3SUFZRFZSMFJCQmt3RjRjRWZ3QUFBWWNFd0tnT01vSUpiRzlqWVd4b2IzTjAKTUE0R0ExVWREd0VCL3dRRUF3SUhnREFUQmdOVkhTVUVEREFLQmdnckJnRUZCUWNEQVRBZEJnTlZIUTRFRmdRVQo2RkhoMlFHSlBLR2JsdGV6NE84ZXE0NWFjWFF3RHdZRFZSMFRBUUgvQkFVd0F3RUJBREFLQmdncWhrak9QUVFECkF3Tm9BREJsQWpFQXZ2Yk1RVnFKWGZGejhyTVAvcHdCRUpDNmJheGpuMzUvVTN3aWplYmNncEFVbnkwbFFNU0YKcUNjYms4L21wTXkzQWpBaWZDZnJyVVVxbGJWaVRTSlVlanBScEZMaUpldlliZDdhZ0dGaHVMOWNtakowa0srQQpqT1hMcFpBU3ZkWGxPakk9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUIrVENDQVgrZ0F3SUJBZ0lVU3ZtQmgrMXVHSDlTaXhhbVp5OExjM1JESXZjd0NnWUlLb1pJemowRUF3TXcKSmpFVE1CRUdBMVVFQXd3S1RtbHZZMkVnVW05dmRERVBNQTBHQTFVRUNnd0dUWGtnVDNKbk1CNFhEVEl6TURVegpNREE1TVRReE1Wb1hEVE16TURneU1ERTFOVFl4TVZvd0xqRWJNQmtHQTFVRUF3d1NUbWx2WTJFZ1NXNTBaWEp0ClpXUnBZWFJsTVE4d0RRWURWUVFLREFaTmVTQlBjbWN3ZGpBUUJnY3Foa2pPUFFJQkJnVXJnUVFBSWdOaUFBU3IKbnNjTXB4M1JwMVZjSDJvOHNyYmlNWDRSNEsyUEJTRlBJdHFUcng2YmVOUk9XTHM5VDkzeEZHUUFwMWJZQTQ4SgplckQ5cm1OeEZ3TGh4TGQxQm41eHRRcXpVQ2VYamYvYUNnbmx2eVZtMDduMUVqOWZGYWRlMlZ5cS84ZXNiaXFqClpqQmtNQjhHQTFVZEl3UVlNQmFBRkJ4Q0I5RmFPRlBIRnhzOTNUQzFMeVB0RmQrME1BNEdBMVVkRHdFQi93UUUKQXdJQmhqQWRCZ05WSFE0RUZnUVVTdm1CaCsxdUdIOVNpeGFtWnk4TGMzUkRJdmN3RWdZRFZSMFRBUUgvQkFndwpCZ0VCL3dJQkFEQUtCZ2dxaGtqT1BRUURBd05vQURCbEFqQm5seDc1ZGtUbE5KOXBmWmVkYThsbTJ0dU0zcGxVCk5PZ05OQlJsK3dlWjl4ajIrc2NPSmZHZFNEdm1RaHFaV1c0Q01RQ01EVlBmOFRyL0dGQ0FLS2ttQWJqcFN4ejEKOTczT0dzeVpFWE0rK2tHQWNwLzQyRzd3TGZFMnd3U2tqYWRRTkdnPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlCOFRDQ0FYYWdBd0lCQWdJVUhFSUgwVm80VThjWEd6M2RNTFV2SSswVjM3UXdDZ1lJS29aSXpqMEVBd013CkpqRVRNQkVHQTFVRUF3d0tUbWx2WTJFZ1VtOXZkREVQTUEwR0ExVUVDZ3dHVFhrZ1QzSm5NQ0FYRFRJeU1EWXcKTmpFNU5UZzBOVm9ZRHpJd05UTXdPREUxTVRVMU5UUTFXakFtTVJNd0VRWURWUVFEREFwT2FXOWpZU0JTYjI5MApNUTh3RFFZRFZRUUtEQVpOZVNCUGNtY3dkakFRQmdjcWhrak9QUUlCQmdVcmdRUUFJZ05pQUFSTUZ3cVprVG1ZCjJYZUtSSm5iK3FkS1Z6WWtYa3ovZjRnZFF4dmRnZkRDanlPTjJqN3hwU2ttZTNnL09ZeGhtTjFwbnRJY2JmUWIKenJZNHdLNUl6SFV6M2x5SEppZkE2L0RWa3dwdGFBa0x2UEhRVko1NytCaHRVM0pTaERVeEI1MmpZekJoTUI4RwpBMVVkSXdRWU1CYUFGQnhDQjlGYU9GUEhGeHM5M1RDMUx5UHRGZCswTUE0R0ExVWREd0VCL3dRRUF3SUJoakFkCkJnTlZIUTRFRmdRVUhFSUgwVm80VThjWEd6M2RNTFV2SSswVjM3UXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QUsKQmdncWhrak9QUVFEQXdOcEFEQm1BakVBZ0x5dXE2SGE1NmJUdzBYMko3ODNhalFDa1Z5dTJ3NUlYQnVPNk9vaApkeFdmUDhRQ0N3UzBUZFFkc0JrMGM1QmVBakVBdUE3ekViZXViMVpKSVRZQm9nMFhmb3pUbG5iSWlEcEFndEFhCnR5TzVjcDBVSld4RXB1NGdhZ1JUTDYyRldXVVcKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
-- UNSEAL_KEY_B64="LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JRzJBZ0VBTUJBR0J5cUdTTTQ5QWdFR0JTdUJCQUFpQklHZU1JR2JBZ0VCQkRBaVdxNWFKb1FRTHRZS3VCUGoKc3BrdU5McHhQMEthNHhheW02b0oySTl6Y2dsbkxncVg4ZFllOEpZQXp5K1lXQ09oWkFOaUFBU2JwZVQ4c1ZlbgpQSEJ1N09GSm1jc0haOVNNZVNmUDU4Q0xwcFNXMDRjUEZLYUxpcCs2V0JpT0R6MElHcEU3OFVER2pWQ1BqMmZpCkZ3bGgwSCtXdTdDdTlheDUyYS9TdDZYMGVDWFpMdTZPeXJtUk9KMmhWNlFOUHJqbGQ0NFUwNkE9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K"

-- The corresponding root certificate which can be imported in your browser for an OK trust chain:
-- -----BEGIN CERTIFICATE-----
-- MIIB8TCCAXagAwIBAgIUHEIH0Vo4U8cXGz3dMLUvI+0V37QwCgYIKoZIzj0EAwMw
-- JjETMBEGA1UEAwwKTmlvY2EgUm9vdDEPMA0GA1UECgwGTXkgT3JnMCAXDTIyMDYw
-- NjE5NTg0NVoYDzIwNTMwODE1MTU1NTQ1WjAmMRMwEQYDVQQDDApOaW9jYSBSb290
-- MQ8wDQYDVQQKDAZNeSBPcmcwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAARMFwqZkTmY
-- 2XeKRJnb+qdKVzYkXkz/f4gdQxvdgfDCjyON2j7xpSkme3g/OYxhmN1pntIcbfQb
-- zrY4wK5IzHUz3lyHJifA6/DVkwptaAkLvPHQVJ57+BhtU3JShDUxB52jYzBhMB8G
-- A1UdIwQYMBaAFBxCB9FaOFPHFxs93TC1LyPtFd+0MA4GA1UdDwEB/wQEAwIBhjAd
-- BgNVHQ4EFgQUHEIH0Vo4U8cXGz3dMLUvI+0V37QwDwYDVR0TAQH/BAUwAwEB/zAK
-- BggqhkjOPQQDAwNpADBmAjEAgLyuq6Ha56bTw0X2J783ajQCkVyu2w5IXBuO6Ooh
-- dxWfP8QCCwS0TdQdsBk0c5BeAjEAuA7zEbeub1ZJITYBog0XfozTlnbIiDpAgtAa
-- tyO5cp0UJWxEpu4gagRTL62FWWUW
-- -----END CERTIFICATE-----

insert into master_key (id, value)
values ('check_shard_1', 'ab5d3ea3ed2ec757e95a08a354b882dd111799391c18e15550f99264773d870c'),
       ('check_shard_2', 'a49a0731a5ec74e146af0f6689c9429b9cd237e9de3b4db0d4e97b10905ca481'),
       ('check_master', 'e52a976ceafaad3a791fdb0526a8ce34e0085c650da6efb282b0b4e9acef53ee'),
       ('enc_key_active', '7aa5066e-39d2-4de7-aeb0-e7a411afa5d9'),
       ('initialized', '1692806548'),
       ('local_password',
        '$argon2id$v=19$m=32768,t=3,p=2$QiOSgFFrrJQR1qoMDSlf/w$Zfj1pMInly7geW+W4Q7MDzCIOEql+P7iXnhO0iIb9xs');
--        ('default_x509', '4dc0e30d-e845-46a9-8d22-590470990da6');

insert into enc_keys (id, alg, value)
values ('7aa5066e-39d2-4de7-aeb0-e7a411afa5d9', 'ChaCha20Poly1305',
        '\xAED5EB0B69A97E45A7AD2DD03D783BDC972F949D400B2B7B39FBB1672752616F004991E7BA01DA1F8A256B1CF81B0C00AE65973A9499045F987F8301'::bytea);

insert into ca_certs_x509 (id, typ, name, expires, data, fingerprint, enc_key_id)
values ('4dc0e30d-e845-46a9-8d22-590470990da6', 'root', 'default', '2053-08-15 15:55:45.000000 +00:00', '-----BEGIN CERTIFICATE-----
MIIB8TCCAXagAwIBAgIUHEIH0Vo4U8cXGz3dMLUvI+0V37QwCgYIKoZIzj0EAwMw
JjETMBEGA1UEAwwKTmlvY2EgUm9vdDEPMA0GA1UECgwGTXkgT3JnMCAXDTIyMDYw
NjE5NTg0NVoYDzIwNTMwODE1MTU1NTQ1WjAmMRMwEQYDVQQDDApOaW9jYSBSb290
MQ8wDQYDVQQKDAZNeSBPcmcwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAARMFwqZkTmY
2XeKRJnb+qdKVzYkXkz/f4gdQxvdgfDCjyON2j7xpSkme3g/OYxhmN1pntIcbfQb
zrY4wK5IzHUz3lyHJifA6/DVkwptaAkLvPHQVJ57+BhtU3JShDUxB52jYzBhMB8G
A1UdIwQYMBaAFBxCB9FaOFPHFxs93TC1LyPtFd+0MA4GA1UdDwEB/wQEAwIBhjAd
BgNVHQ4EFgQUHEIH0Vo4U8cXGz3dMLUvI+0V37QwDwYDVR0TAQH/BAUwAwEB/zAK
BggqhkjOPQQDAwNpADBmAjEAgLyuq6Ha56bTw0X2J783ajQCkVyu2w5IXBuO6Ooh
dxWfP8QCCwS0TdQdsBk0c5BeAjEAuA7zEbeub1ZJITYBog0XfozTlnbIiDpAgtAa
tyO5cp0UJWxEpu4gagRTL62FWWUW
-----END CERTIFICATE-----',
        '\x635F1F1942273D68856C1B851C0361612A6B7159D41B0A18BA473EA264A357ABD237F02AB107685896FE61F76C0432EF1245C2241CE3F8343004AA3EF992770D46033DD86509FB326CC6C7CA50A2942C9C0D6D32CCE9D3352F8C87A69FAED95D71F668'::bytea,
        '7aa5066e-39d2-4de7-aeb0-e7a411afa5d9'),
       ('4dc0e30d-e845-46a9-8d22-590470990da6', 'certificate', 'default', '2033-08-20 15:56:11.000000 +00:00', '-----BEGIN CERTIFICATE-----
MIIB+TCCAX+gAwIBAgIUSvmBh+1uGH9SixamZy8Lc3RDIvcwCgYIKoZIzj0EAwMw
JjETMBEGA1UEAwwKTmlvY2EgUm9vdDEPMA0GA1UECgwGTXkgT3JnMB4XDTIzMDUz
MDA5MTQxMVoXDTMzMDgyMDE1NTYxMVowLjEbMBkGA1UEAwwSTmlvY2EgSW50ZXJt
ZWRpYXRlMQ8wDQYDVQQKDAZNeSBPcmcwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAASr
nscMpx3Rp1VcH2o8srbiMX4R4K2PBSFPItqTrx6beNROWLs9T93xFGQAp1bYA48J
erD9rmNxFwLhxLd1Bn5xtQqzUCeXjf/aCgnlvyVm07n1Ej9fFade2Vyq/8esbiqj
ZjBkMB8GA1UdIwQYMBaAFBxCB9FaOFPHFxs93TC1LyPtFd+0MA4GA1UdDwEB/wQE
AwIBhjAdBgNVHQ4EFgQUSvmBh+1uGH9SixamZy8Lc3RDIvcwEgYDVR0TAQH/BAgw
BgEB/wIBADAKBggqhkjOPQQDAwNoADBlAjBnlx75dkTlNJ9pfZeda8lm2tuM3plU
NOgNNBRl+weZ9xj2+scOJfGdSDvmQhqZWW4CMQCMDVPf8Tr/GFCAKKkmAbjpSxz1
973OGsyZEXM++kGAcp/42G7wLfE2wwSkjadQNGg=
-----END CERTIFICATE-----',
        '\xEF43768ADC1AA8DD7554BE613BBDF6AD62618C61AEF9E4F588053FBB6940831A441AE1363EBAB341988D8545511D28C8DB5597F9A904F7574E2450FE7F3DD543B8CED64F7C86F648E28BA5DAD133A000124D3921B977CC688C63545B884AAC51E3FEC3'::bytea,
        '7aa5066e-39d2-4de7-aeb0-e7a411afa5d9'),
       ('4dc0e30d-e845-46a9-8d22-590470990da6', 'key', 'default', null,
        '97ceb325add6c00ee5c9322c5f8400befd4e82dadac3c9ace041ffe036e3efafcc94bf56d87b77d40fbd0a6c3be03a56a5c05b7a38ac75c106ceb8e7d60645ba659b038779c77de49a8e76080bd1b79cbc1f905bda3dbf81a3ce40e9bfc1c118a9dc0a35550d2399fdf1877354b0066c0845a634ff4dd3382fc18517c3c70d2ff3cb6f1edc62d4276a53877fd1c82859e2d96265ae8bbbc3100dc743ad0aaff308c5a8a25e20f03a3a6136c0b8fdec7bcc7a3d8097935d63595aac6207c4366d0c8b77710705ee0a1562e9e1b41043b2a9500e2cc5fdde68f6bccb570d65932d5518eadffa94018fbbebc353d08ce92717e69d725cce1e460317ba79a40a65b0f95f32f7a39ac4b1da7080b01dba8ff97d5fa2831b823b9a0617c37a0dc3e11359e9db4588ef643959899545810e7f25698d6ef08af4eea5afff91e2b8bd1271f3ff846c8f5b3442360b4d927c1f',
        null, '7aa5066e-39d2-4de7-aeb0-e7a411afa5d9');

update nioca.groups set ca_x509 = '4dc0e30d-e845-46a9-8d22-590470990da6', ca_x509_typ = 'certificate' where name = 'default';
