import{s as Pe,r as Rt,I as ze,f as R,a as M,g as T,h as O,d as _,c as N,j as L,k as le,J as Be,G as Fe,i as I,x as P,H as Oe,u as Tt,v as Vt,w as Ht,A as St,K as Ge,L as At,M as qt,l as X,m as U,n as Re,E as jt,t as Ot,p as W,D as de,F as Y,e as pe,B as Je,C as We,y as Ye,o as pt}from"../chunks/scheduler.62f7bfe4.js";import{S as ye,i as Ee,a as w,g as fe,t as y,c as ue,f as Ze,h as Z,b as S,d as A,m as q,e as j}from"../chunks/index.4f29d4fa.js";import{k as Xt,l as Ut,i as Qe,P as we,c as ht,a as ge,a1 as zt,ae as Bt,B as Ie,a6 as xe,e as gt,ac as Xe,x as et,f as Ft}from"../chunks/CheckIcon.c1eafc35.js";const $e={"Content-Type":"application/json",Accept:"application/json"};async function Gt(r){return await fetch("/unseal/key",{method:"POST",headers:$e,body:JSON.stringify(r)})}async function Jt(r){return await fetch("/unseal/execute",{method:"POST",headers:$e,body:JSON.stringify(r)})}async function Wt(r){return await fetch("/unseal/init",{method:"POST",headers:$e,body:JSON.stringify(r)})}async function Yt(r){return await fetch("/unseal/init/check",{method:"POST",headers:$e,body:JSON.stringify(r)})}async function wt(){return await fetch("/unseal/status",{method:"GET",headers:$e})}async function bt(){return await fetch("/unseal/xsrf",{method:"GET",headers:$e})}function tt(r){let e,t,n,a;return{c(){e=R("div"),t=X(r[5]),this.h()},l(l){e=T(l,"DIV",{class:!0});var s=O(e);t=U(s,r[5]),s.forEach(_),this.h()},h(){L(e,"class","err font-label svelte-1lcnpjp"),le(e,"width",r[6])},m(l,s){I(l,e,s),P(e,t),a=!0},p(l,s){(!a||s&32)&&Re(t,l[5]),s&64&&le(e,"width",l[6])},i(l){a||(jt(()=>{a&&(n||(n=Ze(e,Qe,{duration:250},!0)),n.run(1))}),a=!0)},o(l){n||(n=Ze(e,Qe,{duration:250},!1)),n.run(0),a=!1},d(l){l&&_(e),l&&n&&n.end()}}}function Zt(r){let e,t,n,a,l,s,o,f=`calc(${r[6]} + 12px)`,i,u,p;const v=r[13].default,k=Rt(v,r,r[12],null);let K=[{name:r[3]},{disabled:r[4]},{value:r[0]},{rows:r[1]},{cols:r[2]},r[11]],h={};for(let d=0;d<K.length;d+=1)h=ze(h,K[d]);let m=r[5]&&tt(r);return{c(){e=R("div"),t=R("div"),n=R("div"),a=R("label"),k&&k.c(),l=M(),s=R("textarea"),o=M(),m&&m.c(),this.h()},l(d){e=T(d,"DIV",{class:!0});var b=O(e);t=T(b,"DIV",{class:!0});var E=O(t);n=T(E,"DIV",{class:!0});var te=O(n);a=T(te,"LABEL",{for:!0});var Q=O(a);k&&k.l(Q),Q.forEach(_),te.forEach(_),E.forEach(_),l=N(b),s=T(b,"TEXTAREA",{name:!0,rows:!0,cols:!0}),O(s).forEach(_),o=N(b),m&&m.l(b),b.forEach(_),this.h()},h(){L(a,"for",r[3]),L(n,"class","labelInner font-label noselect svelte-1lcnpjp"),le(n,"background",r[4]?"var(--col-gmid)":"var(--col-bg)"),L(t,"class","label svelte-1lcnpjp"),Be(s,h),le(s,"resize",r[7]?"none":""),le(s,"width",r[6]),Fe(s,"svelte-1lcnpjp",!0),L(e,"class","container svelte-1lcnpjp"),le(e,"width",f)},m(d,b){I(d,e,b),P(e,t),P(t,n),P(n,a),k&&k.m(a,null),P(e,l),P(e,s),s.autofocus&&s.focus(),P(e,o),m&&m.m(e,null),i=!0,u||(p=[Oe(s,"input",r[8]),Oe(s,"focus",r[9]),Oe(s,"blur",r[10])],u=!0)},p(d,[b]){k&&k.p&&(!i||b&4096)&&Tt(k,v,d,d[12],i?Ht(v,d[12],b,null):Vt(d[12]),null),(!i||b&8)&&L(a,"for",d[3]),b&16&&le(n,"background",d[4]?"var(--col-gmid)":"var(--col-bg)"),Be(s,h=Xt(K,[(!i||b&8)&&{name:d[3]},(!i||b&16)&&{disabled:d[4]},(!i||b&1)&&{value:d[0]},(!i||b&2)&&{rows:d[1]},(!i||b&4)&&{cols:d[2]},b&2048&&d[11]])),le(s,"resize",d[7]?"none":""),le(s,"width",d[6]),Fe(s,"svelte-1lcnpjp",!0),d[5]?m?(m.p(d,b),b&32&&w(m,1)):(m=tt(d),m.c(),w(m,1),m.m(e,null)):m&&(fe(),y(m,1,1,()=>{m=null}),ue()),b&64&&f!==(f=`calc(${d[6]} + 12px)`)&&le(e,"width",f)},i(d){i||(w(k,d),w(m),i=!0)},o(d){y(k,d),y(m),i=!1},d(d){d&&_(e),k&&k.d(d),m&&m.d(),u=!1,St(p)}}}function Qt(r,e,t){const n=["rows","cols","name","disabled","error","value","width","fixed"];let a=Ge(e,n),{$$slots:l={},$$scope:s}=e,{rows:o=10}=e,{cols:f=10}=e,{name:i=Ut()}=e,{disabled:u=!1}=e,{error:p=""}=e,{value:v=""}=e,{width:k="32rem"}=e,{fixed:K=!0}=e;const h=At();async function m(E){await Ot(),t(0,v=E.target.value),h("input",v)}function d(){h("focus",!0)}function b(){h("blur",!0)}return r.$$set=E=>{e=ze(ze({},e),qt(E)),t(11,a=Ge(e,n)),"rows"in E&&t(1,o=E.rows),"cols"in E&&t(2,f=E.cols),"name"in E&&t(3,i=E.name),"disabled"in E&&t(4,u=E.disabled),"error"in E&&t(5,p=E.error),"value"in E&&t(0,v=E.value),"width"in E&&t(6,k=E.width),"fixed"in E&&t(7,K=E.fixed),"$$scope"in E&&t(12,s=E.$$scope)},[v,o,f,i,u,p,k,K,m,d,b,a,s,l]}class Ue extends ye{constructor(e){super(),Ee(this,e,Qt,Zt,Pe,{rows:1,cols:2,name:3,disabled:4,error:5,value:0,width:6,fixed:7})}}function xt(r){let e;return{c(){e=X("Root Certificate in PEM format")},l(t){e=U(t,"Root Certificate in PEM format")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function er(r){let e;return{c(){e=X("Intermediate Certificate in PEM format")},l(t){e=U(t,"Intermediate Certificate in PEM format")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function tr(r){let e;return{c(){e=X("Intermediate Key in encrypted PEM-HEX format")},l(t){e=U(t,"Intermediate Key in encrypted PEM-HEX format")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function rr(r){let e;return{c(){e=X("Intermediate Key encryption password")},l(t){e=U(t,"Intermediate Key encryption password")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function sr(r){let e;return{c(){e=X("Nioca Init Key")},l(t){e=U(t,"Nioca Init Key")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function nr(r){let e;return{c(){e=X("New local account password")},l(t){e=U(t,"New local account password")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function ar(r){let e;return{c(){e=X("New local account password confirm")},l(t){e=U(t,"New local account password confirm")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function rt(r){let e,t,n;function a(s){r[23](s)}let l={$$slots:{default:[ir]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.isLoading=r[0]),e=new Ie({props:l}),W.push(()=>Z(e,"isLoading",a)),e.$on("click",r[24]),{c(){S(e.$$.fragment)},l(s){A(e.$$.fragment,s)},m(s,o){q(e,s,o),n=!0},p(s,o){const f={};o&1073741824&&(f.$$scope={dirty:o,ctx:s}),!t&&o&1&&(t=!0,f.isLoading=s[0],Y(()=>t=!1)),e.$set(f)},i(s){n||(w(e.$$.fragment,s),n=!0)},o(s){y(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function ir(r){let e;return{c(){e=X("VALIDATE")},l(t){e=U(t,"VALIDATE")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function st(r){let e,t,n,a,l,s,o,f,i;return a=new xe({props:{cert:r[2].root}}),f=new xe({props:{cert:r[2].intermediate}}),{c(){e=R("div"),t=R("div"),n=X(`Root Certificate:
                `),S(a.$$.fragment),l=M(),s=R("div"),o=X(`Intermediate Certificate:
                `),S(f.$$.fragment),this.h()},l(u){e=T(u,"DIV",{class:!0});var p=O(e);t=T(p,"DIV",{class:!0});var v=O(t);n=U(v,`Root Certificate:
                `),A(a.$$.fragment,v),v.forEach(_),l=N(p),s=T(p,"DIV",{class:!0});var k=O(s);o=U(k,`Intermediate Certificate:
                `),A(f.$$.fragment,k),k.forEach(_),p.forEach(_),this.h()},h(){L(t,"class","checkCert svelte-5utp02"),L(s,"class","checkCert svelte-5utp02"),L(e,"class","checkRes svelte-5utp02")},m(u,p){I(u,e,p),P(e,t),P(t,n),q(a,t,null),P(e,l),P(e,s),P(s,o),q(f,s,null),i=!0},p(u,p){const v={};p&4&&(v.cert=u[2].root),a.$set(v);const k={};p&4&&(k.cert=u[2].intermediate),f.$set(k)},i(u){i||(w(a.$$.fragment,u),w(f.$$.fragment,u),i=!0)},o(u){y(a.$$.fragment,u),y(f.$$.fragment,u),i=!1},d(u){u&&_(e),j(a),j(f)}}}function nt(r){let e,t=`<div class="initNoteHeader svelte-5utp02">CAUTION</div>
            The initialization is not reversible!<br/>
            After it has been successful, you will be shown the master keys.<br/> <span class="bold svelte-5utp02">They will only appear once!</span><br/><br/>
            Copy them from this UI and save them somewhere really secure.<br/>
            Without these keys, you will not be able to unseal Nioca.<br/><br/>`,n,a,l,s=!r[4]&&at(r);return{c(){e=R("div"),e.innerHTML=t,n=M(),s&&s.c(),a=pe(),this.h()},l(o){e=T(o,"DIV",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1epg0fp"&&(e.innerHTML=t),n=N(o),s&&s.l(o),a=pe(),this.h()},h(){L(e,"class","initNote svelte-5utp02")},m(o,f){I(o,e,f),I(o,n,f),s&&s.m(o,f),I(o,a,f),l=!0},p(o,f){o[4]?s&&(fe(),y(s,1,1,()=>{s=null}),ue()):s?(s.p(o,f),f&16&&w(s,1)):(s=at(o),s.c(),w(s,1),s.m(a.parentNode,a))},i(o){l||(w(s),l=!0)},o(o){y(s),l=!1},d(o){o&&(_(e),_(n),_(a)),s&&s.d(o)}}}function at(r){let e,t,n;function a(s){r[25](s)}let l={$$slots:{default:[or]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.isLoading=r[0]),e=new Ie({props:l}),W.push(()=>Z(e,"isLoading",a)),e.$on("click",r[26]),{c(){S(e.$$.fragment)},l(s){A(e.$$.fragment,s)},m(s,o){q(e,s,o),n=!0},p(s,o){const f={};o&1073741824&&(f.$$scope={dirty:o,ctx:s}),!t&&o&1&&(t=!0,f.isLoading=s[0],Y(()=>t=!1)),e.$set(f)},i(s){n||(w(e.$$.fragment,s),n=!0)},o(s){y(e.$$.fragment,s),n=!1},d(s){j(e,s)}}}function or(r){let e;return{c(){e=X("INITIALIZE")},l(t){e=U(t,"INITIALIZE")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function it(r){let e,t,n,a,l,s,o="Do not proceed without saving the Master Keys!",f,i,u;return t=new we({props:{value:r[4].masterShard1,width:ve,showCopy:!0,$$slots:{default:[lr]},$$scope:{ctx:r}}}),a=new we({props:{value:r[4].masterShard2,width:ve,showCopy:!0,$$slots:{default:[fr]},$$scope:{ctx:r}}}),i=new Ie({props:{isLoading:r[3],$$slots:{default:[ur]},$$scope:{ctx:r}}}),i.$on("click",r[27]),{c(){e=R("div"),S(t.$$.fragment),n=M(),S(a.$$.fragment),l=M(),s=R("h3"),s.textContent=o,f=M(),S(i.$$.fragment),this.h()},l(p){e=T(p,"DIV",{class:!0});var v=O(e);A(t.$$.fragment,v),n=N(v),A(a.$$.fragment,v),v.forEach(_),l=N(p),s=T(p,"H3",{"data-svelte-h":!0}),de(s)!=="svelte-14zk9g8"&&(s.textContent=o),f=N(p),A(i.$$.fragment,p),this.h()},h(){L(e,"class","keys svelte-5utp02")},m(p,v){I(p,e,v),q(t,e,null),P(e,n),q(a,e,null),I(p,l,v),I(p,s,v),I(p,f,v),q(i,p,v),u=!0},p(p,v){const k={};v&16&&(k.value=p[4].masterShard1),v&1073741824&&(k.$$scope={dirty:v,ctx:p}),t.$set(k);const K={};v&16&&(K.value=p[4].masterShard2),v&1073741824&&(K.$$scope={dirty:v,ctx:p}),a.$set(K);const h={};v&8&&(h.isLoading=p[3]),v&1073741824&&(h.$$scope={dirty:v,ctx:p}),i.$set(h)},i(p){u||(w(t.$$.fragment,p),w(a.$$.fragment,p),w(i.$$.fragment,p),u=!0)},o(p){y(t.$$.fragment,p),y(a.$$.fragment,p),y(i.$$.fragment,p),u=!1},d(p){p&&(_(e),_(l),_(s),_(f)),j(t),j(a),j(i,p)}}}function lr(r){let e;return{c(){e=X("Master Key 1")},l(t){e=U(t,"Master Key 1")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function fr(r){let e;return{c(){e=X("Master Key 2")},l(t){e=U(t,"Master Key 2")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function ur(r){let e;return{c(){e=X("PROCEED")},l(t){e=U(t,"PROCEED")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function ot(r){let e,t;return{c(){e=R("div"),t=X(r[5]),this.h()},l(n){e=T(n,"DIV",{class:!0});var a=O(e);t=U(a,r[5]),a.forEach(_),this.h()},h(){L(e,"class","errMain svelte-5utp02")},m(n,a){I(n,e,a),P(e,t)},p(n,a){a&32&&Re(t,n[5])},d(n){n&&_(e)}}}function cr(r){let e,t,n=`<h1>Nioca has not been initialized</h1>

        Nioca has not been initialized yet.<br/>
        You will do it on this page.<br/><br/>

        What you will need for the process:
        <ul><li>Root Certificate in PEM format</li> <li>Intermediate Certificate in PEM format</li> <li>Intermediate Key in encrypted DER-HEX format<br/> -&gt; generated by the nioca cli tool</li> <li>Intermediate Key encryption password<br/> -&gt; set during bootstrap with the nioca cli tool</li> <li>Nioca Init Key<br/> -&gt; logged into the console at startup</li></ul>`,a,l,s,o,f,i,u,p,v,k,K,h,m,d,b,E,te,Q,x,ne,ae,ce,D,H,C,V,z,ie,oe,$,ke,me,be,he,re;function _e(c){r[9](c)}function vt(c){r[10](c)}let Te={rows:"17",name:"rootPem",placeholder:"Root Certificate in PEM format",$$slots:{default:[xt]},$$scope:{ctx:r}};r[6].rootPem!==void 0&&(Te.value=r[6].rootPem),r[7].rootPem!==void 0&&(Te.error=r[7].rootPem),l=new Ue({props:Te}),W.push(()=>Z(l,"value",_e)),W.push(()=>Z(l,"error",vt));function $t(c){r[11](c)}function kt(c){r[12](c)}let Ve={rows:"17",name:"intermediatePem",placeholder:"Intermediate Certificate in PEM format",$$slots:{default:[er]},$$scope:{ctx:r}};r[6].intermediatePem!==void 0&&(Ve.value=r[6].intermediatePem),r[7].intermediatePem!==void 0&&(Ve.error=r[7].intermediatePem),i=new Ue({props:Ve}),W.push(()=>Z(i,"value",$t)),W.push(()=>Z(i,"error",kt));function Pt(c){r[13](c)}function yt(c){r[14](c)}let He={rows:"12",name:"intermediateKeyHex",placeholder:"Intermediate Key in encrypted PEM-HEX format",$$slots:{default:[tr]},$$scope:{ctx:r}};r[6].intermediateKeyHex!==void 0&&(He.value=r[6].intermediateKeyHex),r[7].intermediateKeyHex!==void 0&&(He.error=r[7].intermediateKeyHex),k=new Ue({props:He}),W.push(()=>Z(k,"value",Pt)),W.push(()=>Z(k,"error",yt));function Et(c){r[15](c)}function It(c){r[16](c)}let Se={name:"keyPassword",placeholder:"Encryption Password",width:ve,$$slots:{default:[rr]},$$scope:{ctx:r}};r[6].keyPassword!==void 0&&(Se.value=r[6].keyPassword),r[7].keyPassword!==void 0&&(Se.error=r[7].keyPassword),b=new we({props:Se}),W.push(()=>Z(b,"value",Et)),W.push(()=>Z(b,"error",It));function Ct(c){r[17](c)}function Kt(c){r[18](c)}let Ae={name:"initKey",placeholder:"Nioca Init Key",width:ve,$$slots:{default:[sr]},$$scope:{ctx:r}};r[6].initKey!==void 0&&(Ae.value=r[6].initKey),r[7].initKey!==void 0&&(Ae.error=r[7].initKey),x=new we({props:Ae}),W.push(()=>Z(x,"value",Ct)),W.push(()=>Z(x,"error",Kt));function Lt(c){r[19](c)}function Mt(c){r[20](c)}let qe={name:"localPassword",placeholder:"New Local Password",width:ve,$$slots:{default:[nr]},$$scope:{ctx:r}};r[6].localPassword!==void 0&&(qe.value=r[6].localPassword),r[7].localPassword!==void 0&&(qe.error=r[7].localPassword),D=new we({props:qe}),W.push(()=>Z(D,"value",Lt)),W.push(()=>Z(D,"error",Mt));function Nt(c){r[21](c)}function Dt(c){r[22](c)}let je={name:"localPasswordConfirm",placeholder:"New Local Password Confirm",width:ve,$$slots:{default:[ar]},$$scope:{ctx:r}};r[6].localPasswordConfirm!==void 0&&(je.value=r[6].localPasswordConfirm),r[7].localPasswordConfirm!==void 0&&(je.error=r[7].localPasswordConfirm),z=new we({props:je}),W.push(()=>Z(z,"value",Nt)),W.push(()=>Z(z,"error",Dt));let B=!r[4]&&rt(r),F=r[2]&&st(r),G=r[1]&&nt(r),J=r[4]&&it(r),ee=r[5]&&ot(r);return{c(){e=R("div"),t=R("div"),t.innerHTML=n,a=M(),S(l.$$.fragment),f=M(),S(i.$$.fragment),v=M(),S(k.$$.fragment),m=M(),d=R("div"),S(b.$$.fragment),Q=M(),S(x.$$.fragment),ce=M(),S(D.$$.fragment),V=M(),S(z.$$.fragment),$=M(),B&&B.c(),ke=M(),F&&F.c(),me=M(),G&&G.c(),be=M(),J&&J.c(),he=M(),ee&&ee.c(),this.h()},l(c){e=T(c,"DIV",{class:!0});var g=O(e);t=T(g,"DIV",{class:!0,"data-svelte-h":!0}),de(t)!=="svelte-ze6qll"&&(t.innerHTML=n),a=N(g),A(l.$$.fragment,g),f=N(g),A(i.$$.fragment,g),v=N(g),A(k.$$.fragment,g),m=N(g),d=T(g,"DIV",{class:!0});var se=O(d);A(b.$$.fragment,se),Q=N(se),A(x.$$.fragment,se),ce=N(se),A(D.$$.fragment,se),V=N(se),A(z.$$.fragment,se),se.forEach(_),$=N(g),B&&B.l(g),ke=N(g),F&&F.l(g),me=N(g),G&&G.l(g),be=N(g),J&&J.l(g),he=N(g),ee&&ee.l(g),g.forEach(_),this.h()},h(){L(t,"class","desc svelte-5utp02"),L(d,"class","block svelte-5utp02"),L(e,"class","container svelte-5utp02")},m(c,g){I(c,e,g),P(e,t),P(e,a),q(l,e,null),P(e,f),q(i,e,null),P(e,v),q(k,e,null),P(e,m),P(e,d),q(b,d,null),P(d,Q),q(x,d,null),P(d,ce),q(D,d,null),P(d,V),q(z,d,null),P(e,$),B&&B.m(e,null),P(e,ke),F&&F.m(e,null),P(e,me),G&&G.m(e,null),P(e,be),J&&J.m(e,null),P(e,he),ee&&ee.m(e,null),re=!0},p(c,[g]){const se={};g&1073741824&&(se.$$scope={dirty:g,ctx:c}),!s&&g&64&&(s=!0,se.value=c[6].rootPem,Y(()=>s=!1)),!o&&g&128&&(o=!0,se.error=c[7].rootPem,Y(()=>o=!1)),l.$set(se);const Ce={};g&1073741824&&(Ce.$$scope={dirty:g,ctx:c}),!u&&g&64&&(u=!0,Ce.value=c[6].intermediatePem,Y(()=>u=!1)),!p&&g&128&&(p=!0,Ce.error=c[7].intermediatePem,Y(()=>p=!1)),i.$set(Ce);const Ke={};g&1073741824&&(Ke.$$scope={dirty:g,ctx:c}),!K&&g&64&&(K=!0,Ke.value=c[6].intermediateKeyHex,Y(()=>K=!1)),!h&&g&128&&(h=!0,Ke.error=c[7].intermediateKeyHex,Y(()=>h=!1)),k.$set(Ke);const Le={};g&1073741824&&(Le.$$scope={dirty:g,ctx:c}),!E&&g&64&&(E=!0,Le.value=c[6].keyPassword,Y(()=>E=!1)),!te&&g&128&&(te=!0,Le.error=c[7].keyPassword,Y(()=>te=!1)),b.$set(Le);const Me={};g&1073741824&&(Me.$$scope={dirty:g,ctx:c}),!ne&&g&64&&(ne=!0,Me.value=c[6].initKey,Y(()=>ne=!1)),!ae&&g&128&&(ae=!0,Me.error=c[7].initKey,Y(()=>ae=!1)),x.$set(Me);const Ne={};g&1073741824&&(Ne.$$scope={dirty:g,ctx:c}),!H&&g&64&&(H=!0,Ne.value=c[6].localPassword,Y(()=>H=!1)),!C&&g&128&&(C=!0,Ne.error=c[7].localPassword,Y(()=>C=!1)),D.$set(Ne);const De={};g&1073741824&&(De.$$scope={dirty:g,ctx:c}),!ie&&g&64&&(ie=!0,De.value=c[6].localPasswordConfirm,Y(()=>ie=!1)),!oe&&g&128&&(oe=!0,De.error=c[7].localPasswordConfirm,Y(()=>oe=!1)),z.$set(De),c[4]?B&&(fe(),y(B,1,1,()=>{B=null}),ue()):B?(B.p(c,g),g&16&&w(B,1)):(B=rt(c),B.c(),w(B,1),B.m(e,ke)),c[2]?F?(F.p(c,g),g&4&&w(F,1)):(F=st(c),F.c(),w(F,1),F.m(e,me)):F&&(fe(),y(F,1,1,()=>{F=null}),ue()),c[1]?G?(G.p(c,g),g&2&&w(G,1)):(G=nt(c),G.c(),w(G,1),G.m(e,be)):G&&(fe(),y(G,1,1,()=>{G=null}),ue()),c[4]?J?(J.p(c,g),g&16&&w(J,1)):(J=it(c),J.c(),w(J,1),J.m(e,he)):J&&(fe(),y(J,1,1,()=>{J=null}),ue()),c[5]?ee?ee.p(c,g):(ee=ot(c),ee.c(),ee.m(e,null)):ee&&(ee.d(1),ee=null)},i(c){re||(w(l.$$.fragment,c),w(i.$$.fragment,c),w(k.$$.fragment,c),w(b.$$.fragment,c),w(x.$$.fragment,c),w(D.$$.fragment,c),w(z.$$.fragment,c),w(B),w(F),w(G),w(J),re=!0)},o(c){y(l.$$.fragment,c),y(i.$$.fragment,c),y(k.$$.fragment,c),y(b.$$.fragment,c),y(x.$$.fragment,c),y(D.$$.fragment,c),y(z.$$.fragment,c),y(B),y(F),y(G),y(J),re=!1},d(c){c&&_(e),j(l),j(i),j(k),j(b),j(x),j(D),j(z),B&&B.d(),F&&F.d(),G&&G.d(),J&&J.d(),ee&&ee.d()}}}const ve="31rem";function dr(r,e,t){let n=!1,a=!1,l,s=!0,o,f="",i={},u={};const p=ht().shape({rootPem:ge().required("Required").max(5e3,"Maximum length: 5000 characters"),intermediatePem:ge().required("Required").max(5e3,"Maximum length: 5000 characters"),intermediateKeyHex:ge().trim().matches(zt,"Must be a valid HEX format"),localPassword:ge().required("Required").min(16,"At least 16 characters").max(128,"Maximum length: 128 characters"),keyPassword:ge().required("Required").max(1024,"Maximum length: 1024 characters"),initKey:ge().trim().matches(Bt,"Nioca Init Key from log output")});async function v(){return!i.rootPem.includes("-----BEGIN CERTIFICATE-----")||!i.rootPem.includes("-----END CERTIFICATE-----")?(t(7,u.rootPem="Must be a valid PEM format",u),!1):!i.intermediatePem.includes("-----BEGIN CERTIFICATE-----")||!i.intermediatePem.includes("-----END CERTIFICATE-----")?(t(7,u.intermediatePem="Must be a valid PEM format",u),!1):i.localPassword!==i.localPasswordConfirm?(t(7,u.localPasswordConfirm="Local Passwords do not match",u),!1):!0}async function k($){t(5,f="");try{await p.validate(i,{abortEarly:!1}),t(7,u={})}catch(re){t(7,u=gt(re));return}if(!await v())return;t(0,n=!0);const me=await bt();if(!me.ok){let re=await me.json();t(5,f=re.message);return}const be=await me.text(),he={localPassword:i.localPassword,rootPem:i.rootPem,itPem:i.intermediatePem,itKey:i.intermediateKeyHex,itPassword:i.keyPassword,initKey:i.initKey,xsrfKey:be};if(t(0,n=!0),$==="check"){const re=await Yt(he);let _e=await re.json();re.ok?(t(1,a=!0),t(2,l=_e)):t(5,f=_e.message)}else if($==="init"){const re=await Wt(he);let _e=await re.json();re.ok?(t(4,o={masterShard1:_e.masterShard1,masterShard2:_e.masterShard2}),setTimeout(()=>{t(3,s=!1)},5e3)):t(5,f=_e.message)}t(0,n=!1)}function K($){r.$$.not_equal(i.rootPem,$)&&(i.rootPem=$,t(6,i))}function h($){r.$$.not_equal(u.rootPem,$)&&(u.rootPem=$,t(7,u))}function m($){r.$$.not_equal(i.intermediatePem,$)&&(i.intermediatePem=$,t(6,i))}function d($){r.$$.not_equal(u.intermediatePem,$)&&(u.intermediatePem=$,t(7,u))}function b($){r.$$.not_equal(i.intermediateKeyHex,$)&&(i.intermediateKeyHex=$,t(6,i))}function E($){r.$$.not_equal(u.intermediateKeyHex,$)&&(u.intermediateKeyHex=$,t(7,u))}function te($){r.$$.not_equal(i.keyPassword,$)&&(i.keyPassword=$,t(6,i))}function Q($){r.$$.not_equal(u.keyPassword,$)&&(u.keyPassword=$,t(7,u))}function x($){r.$$.not_equal(i.initKey,$)&&(i.initKey=$,t(6,i))}function ne($){r.$$.not_equal(u.initKey,$)&&(u.initKey=$,t(7,u))}function ae($){r.$$.not_equal(i.localPassword,$)&&(i.localPassword=$,t(6,i))}function ce($){r.$$.not_equal(u.localPassword,$)&&(u.localPassword=$,t(7,u))}function D($){r.$$.not_equal(i.localPasswordConfirm,$)&&(i.localPasswordConfirm=$,t(6,i))}function H($){r.$$.not_equal(u.localPasswordConfirm,$)&&(u.localPasswordConfirm=$,t(7,u))}function C($){n=$,t(0,n)}const V=()=>k("check");function z($){n=$,t(0,n)}return[n,a,l,s,o,f,i,u,k,K,h,m,d,b,E,te,Q,x,ne,ae,ce,D,H,C,V,z,()=>k("init"),()=>window.location.reload()]}class mr extends ye{constructor(e){super(),Ee(this,e,dr,cr,Pe,{})}}function _r(r){let e,t;return{c(){e=Je("svg"),t=Je("path"),this.h()},l(n){e=We(n,"svg",{fill:!0,viewBox:!0,stroke:!0,"stroke-width":!0,width:!0,color:!0,opacity:!0});var a=O(e);t=We(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),O(t).forEach(_),a.forEach(_),this.h()},h(){L(t,"stroke-linecap","round"),L(t,"stroke-linejoin","round"),L(t,"d","M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"),L(e,"fill","none"),L(e,"viewBox","0 0 24 24"),L(e,"stroke","currentColor"),L(e,"stroke-width",2),L(e,"width",r[2]),L(e,"color",r[0]),L(e,"opacity",r[1])},m(n,a){I(n,e,a),P(e,t)},p(n,[a]){a&4&&L(e,"width",n[2]),a&1&&L(e,"color",n[0]),a&2&&L(e,"opacity",n[1])},i:Ye,o:Ye,d(n){n&&_(e)}}}function pr(r,e,t){let{color:n}=e,{opacity:a=.9}=e,{width:l=24}=e;return r.$$set=s=>{"color"in s&&t(0,n=s.color),"opacity"in s&&t(1,a=s.opacity),"width"in s&&t(2,l=s.width)},[n,a,l]}class hr extends ye{constructor(e){super(),Ee(this,e,pr,_r,Pe,{color:0,opacity:1,width:2})}}function lt(r){let e,t,n="Status",a,l,s,o="Master Key 1",f,i,u,p,v,k="Master Key 2",K,h,m,d,b,E="Unseal ready",te,Q,x,ne,ae,ce;i=new Xe({props:{check:r[3].masterShard1}}),h=new Xe({props:{check:r[3].masterShard2}}),Q=new Xe({props:{check:r[3].isReady}});let D=!r[3].isReady&&ft(r),H=r[3].isReady&&ct(r);return{c(){e=R("div"),t=R("h3"),t.textContent=n,a=M(),l=R("div"),s=R("div"),s.textContent=o,f=M(),S(i.$$.fragment),u=M(),p=R("div"),v=R("div"),v.textContent=k,K=M(),S(h.$$.fragment),m=M(),d=R("div"),b=R("div"),b.textContent=E,te=M(),S(Q.$$.fragment),x=M(),D&&D.c(),ne=M(),H&&H.c(),ae=pe(),this.h()},l(C){e=T(C,"DIV",{class:!0});var V=O(e);t=T(V,"H3",{"data-svelte-h":!0}),de(t)!=="svelte-ujrwc6"&&(t.textContent=n),a=N(V),l=T(V,"DIV",{class:!0});var z=O(l);s=T(z,"DIV",{class:!0,"data-svelte-h":!0}),de(s)!=="svelte-1wnzkp3"&&(s.textContent=o),f=N(z),A(i.$$.fragment,z),z.forEach(_),u=N(V),p=T(V,"DIV",{class:!0});var ie=O(p);v=T(ie,"DIV",{class:!0,"data-svelte-h":!0}),de(v)!=="svelte-1g2jipe"&&(v.textContent=k),K=N(ie),A(h.$$.fragment,ie),ie.forEach(_),m=N(V),d=T(V,"DIV",{class:!0});var oe=O(d);b=T(oe,"DIV",{class:!0,"data-svelte-h":!0}),de(b)!=="svelte-pruwh4"&&(b.textContent=E),te=N(oe),A(Q.$$.fragment,oe),oe.forEach(_),V.forEach(_),x=N(C),D&&D.l(C),ne=N(C),H&&H.l(C),ae=pe(),this.h()},h(){L(s,"class","statusLabel svelte-ngt9ob"),L(l,"class","statusRow svelte-ngt9ob"),L(v,"class","statusLabel svelte-ngt9ob"),L(p,"class","statusRow svelte-ngt9ob"),L(b,"class","statusLabel svelte-ngt9ob"),L(d,"class","statusRow svelte-ngt9ob"),L(e,"class","status svelte-ngt9ob")},m(C,V){I(C,e,V),P(e,t),P(e,a),P(e,l),P(l,s),P(l,f),q(i,l,null),P(e,u),P(e,p),P(p,v),P(p,K),q(h,p,null),P(e,m),P(e,d),P(d,b),P(d,te),q(Q,d,null),I(C,x,V),D&&D.m(C,V),I(C,ne,V),H&&H.m(C,V),I(C,ae,V),ce=!0},p(C,V){const z={};V&8&&(z.check=C[3].masterShard1),i.$set(z);const ie={};V&8&&(ie.check=C[3].masterShard2),h.$set(ie);const oe={};V&8&&(oe.check=C[3].isReady),Q.$set(oe),C[3].isReady?D&&(fe(),y(D,1,1,()=>{D=null}),ue()):D?(D.p(C,V),V&8&&w(D,1)):(D=ft(C),D.c(),w(D,1),D.m(ne.parentNode,ne)),C[3].isReady?H?(H.p(C,V),V&8&&w(H,1)):(H=ct(C),H.c(),w(H,1),H.m(ae.parentNode,ae)):H&&(fe(),y(H,1,1,()=>{H=null}),ue())},i(C){ce||(w(i.$$.fragment,C),w(h.$$.fragment,C),w(Q.$$.fragment,C),w(D),w(H),ce=!0)},o(C){y(i.$$.fragment,C),y(h.$$.fragment,C),y(Q.$$.fragment,C),y(D),y(H),ce=!1},d(C){C&&(_(e),_(x),_(ne),_(ae)),j(i),j(h),j(Q),D&&D.d(C),H&&H.d(C)}}}function ft(r){let e,t,n,a,l,s,o,f,i,u;t=new hr({props:{width:24}});function p(h){r[8](h)}function v(h){r[9](h)}let k={name:"key",placeholder:"Master Key",$$slots:{default:[gr]},$$scope:{ctx:r}};r[4].key!==void 0&&(k.value=r[4].key),r[5].key!==void 0&&(k.error=r[5].key),a=new we({props:k}),W.push(()=>Z(a,"value",p)),W.push(()=>Z(a,"error",v));let K=r[2]&&ut();return i=new Ie({props:{isLoading:r[0]||r[2],$$slots:{default:[wr]},$$scope:{ctx:r}}}),i.$on("click",r[6]),{c(){e=R("div"),S(t.$$.fragment),n=M(),S(a.$$.fragment),o=M(),K&&K.c(),f=M(),S(i.$$.fragment),this.h()},l(h){e=T(h,"DIV",{class:!0});var m=O(e);A(t.$$.fragment,m),n=N(m),A(a.$$.fragment,m),m.forEach(_),o=N(h),K&&K.l(h),f=N(h),A(i.$$.fragment,h),this.h()},h(){L(e,"class","inputRow svelte-ngt9ob")},m(h,m){I(h,e,m),q(t,e,null),P(e,n),q(a,e,null),I(h,o,m),K&&K.m(h,m),I(h,f,m),q(i,h,m),u=!0},p(h,m){const d={};m&8192&&(d.$$scope={dirty:m,ctx:h}),!l&&m&16&&(l=!0,d.value=h[4].key,Y(()=>l=!1)),!s&&m&32&&(s=!0,d.error=h[5].key,Y(()=>s=!1)),a.$set(d),h[2]?K||(K=ut(),K.c(),K.m(f.parentNode,f)):K&&(K.d(1),K=null);const b={};m&5&&(b.isLoading=h[0]||h[2]),m&8192&&(b.$$scope={dirty:m,ctx:h}),i.$set(b)},i(h){u||(w(t.$$.fragment,h),w(a.$$.fragment,h),w(i.$$.fragment,h),u=!0)},o(h){y(t.$$.fragment,h),y(a.$$.fragment,h),y(i.$$.fragment,h),u=!1},d(h){h&&(_(e),_(o),_(f)),j(t),j(a),K&&K.d(h),j(i,h)}}}function gr(r){let e;return{c(){e=X("Master Key")},l(t){e=U(t,"Master Key")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function ut(r){let e;return{c(){e=X("Waiting for key add rate limiter")},l(t){e=U(t,"Waiting for key add rate limiter")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function wr(r){let e;return{c(){e=X("VALIDATE")},l(t){e=U(t,"VALIDATE")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function ct(r){let e,t="Nioca is ready to be unsealed",n,a,l;return a=new Ie({props:{isLoading:r[0],$$slots:{default:[br]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=R("p"),e.textContent=t,n=M(),S(a.$$.fragment)},l(s){e=T(s,"P",{"data-svelte-h":!0}),de(e)!=="svelte-1icw2ja"&&(e.textContent=t),n=N(s),A(a.$$.fragment,s)},m(s,o){I(s,e,o),I(s,n,o),q(a,s,o),l=!0},p(s,o){const f={};o&1&&(f.isLoading=s[0]),o&8192&&(f.$$scope={dirty:o,ctx:s}),a.$set(f)},i(s){l||(w(a.$$.fragment,s),l=!0)},o(s){y(a.$$.fragment,s),l=!1},d(s){s&&(_(e),_(n)),j(a,s)}}}function br(r){let e;return{c(){e=X("UNSEAL")},l(t){e=U(t,"UNSEAL")},m(t,n){I(t,e,n)},d(t){t&&_(e)}}}function dt(r){let e,t;return{c(){e=R("div"),t=X(r[1]),this.h()},l(n){e=T(n,"DIV",{class:!0});var a=O(e);t=U(a,r[1]),a.forEach(_),this.h()},h(){L(e,"class","errMain svelte-ngt9ob")},m(n,a){I(n,e,a),P(e,t)},p(n,a){a&2&&Re(t,n[1])},d(n){n&&_(e)}}}function vr(r){let e,t,n="Nioca is sealed",a,l,s,o=r[3]&&lt(r),f=r[1]&&dt(r);return{c(){e=R("div"),t=R("h1"),t.textContent=n,a=M(),o&&o.c(),l=M(),f&&f.c(),this.h()},l(i){e=T(i,"DIV",{class:!0});var u=O(e);t=T(u,"H1",{"data-svelte-h":!0}),de(t)!=="svelte-132fqi4"&&(t.textContent=n),a=N(u),o&&o.l(u),l=N(u),f&&f.l(u),u.forEach(_),this.h()},h(){L(e,"class","container svelte-ngt9ob")},m(i,u){I(i,e,u),P(e,t),P(e,a),o&&o.m(e,null),P(e,l),f&&f.m(e,null),s=!0},p(i,[u]){i[3]?o?(o.p(i,u),u&8&&w(o,1)):(o=lt(i),o.c(),w(o,1),o.m(e,l)):o&&(fe(),y(o,1,1,()=>{o=null}),ue()),i[1]?f?f.p(i,u):(f=dt(i),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i(i){s||(w(o),s=!0)},o(i){y(o),s=!1},d(i){i&&_(e),o&&o.d(),f&&f.d()}}}function $r(r,e,t){let n=!1,a="",l=!1,s={},o={},f={};const i=ht().shape({key:ge().required("Required").max(256,"Maximum length: 256 characters")});pt(()=>{u()});async function u(){let m=await wt(),d=await m.json();m.ok?t(3,s=d):t(1,a=d.msg)}async function p(){const m=await bt();if(!m.ok){let d=await m.json();t(1,a=d.message);return}return await m.text()}async function v(){t(1,a="");try{await i.validate(o,{abortEarly:!1}),t(5,f={})}catch(E){t(5,f=gt(E));return}t(0,n=!0);const m=await p(),d={key:o.key,xsrf:m};let b=await Gt(d);if(b.ok)t(4,o.key="",o),t(2,l=!0),setTimeout(()=>{t(2,l=!1)},s.keyAddRateLimit*1e3),await u();else{let E=await b.json();t(1,a=E.message)}t(0,n=!1)}async function k(){t(0,n=!0);let d={xsrf:await p()},b=await Jt(d);if(b.ok)for(await et(3e3);;){try{let E=await Ft().catch(te=>console.error(te));E.ok&&((await E.json()).isSealed||(window.location.href="/"))}catch(E){console.error(E)}await et(2e3)}else{let E=await b.json();t(1,a=E.message),t(0,n=!1)}}function K(m){r.$$.not_equal(o.key,m)&&(o.key=m,t(4,o))}function h(m){r.$$.not_equal(f.key,m)&&(f.key=m,t(5,f))}return[n,a,l,s,o,f,v,k,K,h]}class kr extends ye{constructor(e){super(),Ee(this,e,$r,vr,Pe,{})}}function mt(r){let e,t;return{c(){e=R("div"),t=X(r[1]),this.h()},l(n){e=T(n,"DIV",{style:!0});var a=O(e);t=U(a,r[1]),a.forEach(_),this.h()},h(){le(e,"color","var(--col-err)")},m(n,a){I(n,e,a),P(e,t)},p(n,a){a&2&&Re(t,n[1])},d(n){n&&_(e)}}}function _t(r){let e,t,n,a;const l=[yr,Pr],s=[];function o(f,i){return f[0].isInitialized?0:1}return e=o(r),t=s[e]=l[e](r),{c(){t.c(),n=pe()},l(f){t.l(f),n=pe()},m(f,i){s[e].m(f,i),I(f,n,i),a=!0},p(f,i){let u=e;e=o(f),e!==u&&(fe(),y(s[u],1,1,()=>{s[u]=null}),ue(),t=s[e],t||(t=s[e]=l[e](f),t.c()),w(t,1),t.m(n.parentNode,n))},i(f){a||(w(t),a=!0)},o(f){y(t),a=!1},d(f){f&&_(n),s[e].d(f)}}}function Pr(r){let e,t;return e=new mr({}),{c(){S(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,a){q(e,n,a),t=!0},i(n){t||(w(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function yr(r){let e,t;return e=new kr({}),{c(){S(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,a){q(e,n,a),t=!0},i(n){t||(w(e.$$.fragment,n),t=!0)},o(n){y(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Er(r){let e,t,n,a=r[1]&&mt(r),l=r[0]&&_t(r);return{c(){a&&a.c(),e=M(),l&&l.c(),t=pe()},l(s){a&&a.l(s),e=N(s),l&&l.l(s),t=pe()},m(s,o){a&&a.m(s,o),I(s,e,o),l&&l.m(s,o),I(s,t,o),n=!0},p(s,[o]){s[1]?a?a.p(s,o):(a=mt(s),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),s[0]?l?(l.p(s,o),o&1&&w(l,1)):(l=_t(s),l.c(),w(l,1),l.m(t.parentNode,t)):l&&(fe(),y(l,1,1,()=>{l=null}),ue())},i(s){n||(w(l),n=!0)},o(s){y(l),n=!1},d(s){s&&(_(e),_(t)),a&&a.d(s),l&&l.d(s)}}}function Ir(r,e,t){let n,a="";pt(()=>{l()});async function l(){let s=await wt(),o=await s.json();s.ok?t(0,n=o):t(1,a=o.msg)}return[n,a]}class Mr extends ye{constructor(e){super(),Ee(this,e,Ir,Er,Pe,{})}}export{Mr as component};
